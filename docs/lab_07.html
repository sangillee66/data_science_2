<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="이상일(서울대학교 지리교육과 교수), 김세창(사회교육과 지리전공 석사), 김우형(사회교육과 지리전공 석사과정)">
<title>Data Science - Lab07: 데이터 수집하기</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lab_06.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script><script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">Lab07: 데이터 수집하기</h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">웹사이트 소개</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">데이터사이언스 강의</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">강의노트</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">R과 데이터사이언스</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R과 RStudio 소개</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R과 데이터사이언스: 개요</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 불러오기와 정리하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 변형하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 시각화하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 탐색하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 수집하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터로 소통하기: Quarto 입문</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터로 소통하기: 대시보드 만들기</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">R 프레젠테이션</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R &amp; RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R &amp; Data Science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Import and Tidying</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Transformation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Collection</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">R 실습</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab01: R과 RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab02: R과 데이터사이언스</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab03: 데이터 불러오기와 정리하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab04: 데이터 변형하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab05: 데이터 시각화하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab06: 데이터 탐색하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_07.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lab07: 데이터 수집하기</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#%EC%8B%A4%EC%8A%B5-%EA%B0%9C%EC%9A%94" id="toc-실습-개요" class="nav-link active" data-scroll-target="#%EC%8B%A4%EC%8A%B5-%EA%B0%9C%EC%9A%94">실습 개요</a></li>
  <li><a href="#%EC%9B%B9%EC%83%81%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%9D%BC-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0" id="toc-웹상의-데이터-파일-불러오기" class="nav-link" data-scroll-target="#%EC%9B%B9%EC%83%81%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%9D%BC-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0"><span class="header-section-number">1</span> 웹상의 데이터 파일 불러오기</a></li>
  <li>
<a href="#%EC%9B%B9%EC%8A%A4%ED%81%AC%EB%A0%88%EC%9D%B4%ED%95%91" id="toc-웹스크레이핑" class="nav-link" data-scroll-target="#%EC%9B%B9%EC%8A%A4%ED%81%AC%EB%A0%88%EC%9D%B4%ED%95%91"><span class="header-section-number">2</span> 웹스크레이핑</a>
  <ul class="collapse">
<li><a href="#%EC%9B%B9%EC%8A%A4%ED%81%AC%EB%A0%88%EC%9D%B4%ED%95%91%EC%9D%98-%EC%8B%A4%EC%A0%9C-1-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%B4-%ED%95%98%EB%82%98-%EC%9E%88%EB%8A%94-%EA%B2%BD%EC%9A%B0" id="toc-웹스크레이핑의-실제-1-테이블이-하나-있는-경우" class="nav-link" data-scroll-target="#%EC%9B%B9%EC%8A%A4%ED%81%AC%EB%A0%88%EC%9D%B4%ED%95%91%EC%9D%98-%EC%8B%A4%EC%A0%9C-1-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%B4-%ED%95%98%EB%82%98-%EC%9E%88%EB%8A%94-%EA%B2%BD%EC%9A%B0"><span class="header-section-number">2.1</span> 웹스크레이핑의 실제 1: 테이블이 하나 있는 경우</a></li>
  <li><a href="#%EC%9B%B9%EC%8A%A4%ED%81%AC%EB%A0%88%EC%9D%B4%ED%95%91%EC%9D%98-%EC%8B%A4%EC%A0%9C-2-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%B4-%EB%91%98-%EC%9D%B4%EC%83%81%EC%9D%B8-%EA%B2%BD%EC%9A%B0" id="toc-웹스크레이핑의-실제-2-테이블이-둘-이상인-경우" class="nav-link" data-scroll-target="#%EC%9B%B9%EC%8A%A4%ED%81%AC%EB%A0%88%EC%9D%B4%ED%95%91%EC%9D%98-%EC%8B%A4%EC%A0%9C-2-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%B4-%EB%91%98-%EC%9D%B4%EC%83%81%EC%9D%B8-%EA%B2%BD%EC%9A%B0"><span class="header-section-number">2.2</span> 웹스크레이핑의 실제 2: 테이블이 둘 이상인 경우</a></li>
  </ul>
</li>
  <li>
<a href="#api%EC%9D%98-%ED%99%9C%EC%9A%A9" id="toc-api의-활용" class="nav-link" data-scroll-target="#api%EC%9D%98-%ED%99%9C%EC%9A%A9"><span class="header-section-number">3</span> API의 활용</a>
  <ul class="collapse">
<li><a href="#kosis%EC%97%90%EC%84%9C-api-key-%EB%B0%9B%EA%B8%B0" id="toc-kosis에서-api-key-받기" class="nav-link" data-scroll-target="#kosis%EC%97%90%EC%84%9C-api-key-%EB%B0%9B%EA%B8%B0"><span class="header-section-number">3.1</span> KOSIS에서 API KEY 받기</a></li>
  <li><a href="#%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%9D%B8%EC%A6%9D%ED%82%A4-%EB%93%B1%EB%A1%9D" id="toc-패키지-설치-및-인증키-등록" class="nav-link" data-scroll-target="#%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%9D%B8%EC%A6%9D%ED%82%A4-%EB%93%B1%EB%A1%9D"><span class="header-section-number">3.2</span> 패키지 설치 및 인증키 등록</a></li>
  <li><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B6%94%EC%B6%9C" id="toc-데이터-추출" class="nav-link" data-scroll-target="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B6%94%EC%B6%9C"><span class="header-section-number">3.3</span> 데이터 추출</a></li>
  <li><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%95%EB%A6%AC-%EB%B0%8F-%EB%B3%80%ED%98%95" id="toc-데이터-정리-및-변형" class="nav-link" data-scroll-target="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%95%EB%A6%AC-%EB%B0%8F-%EB%B3%80%ED%98%95"><span class="header-section-number">3.4</span> 데이터 정리 및 변형</a></li>
  <li><a href="#%EA%B7%B8%EB%9E%98%ED%94%84-%EC%9E%91%EC%84%B1" id="toc-그래프-작성" class="nav-link" data-scroll-target="#%EA%B7%B8%EB%9E%98%ED%94%84-%EC%9E%91%EC%84%B1"><span class="header-section-number">3.5</span> 그래프 작성</a></li>
  <li><a href="#cf-kosis-api%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%ED%95%A8%EC%88%98-%EC%9E%91%EC%84%B1" id="toc-cf-kosis-api를-활용한-함수-작성" class="nav-link" data-scroll-target="#cf-kosis-api%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%ED%95%A8%EC%88%98-%EC%9E%91%EC%84%B1"><span class="header-section-number">3.6</span> cf) KOSIS API를 활용한 함수 작성</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">Lab07: 데이터 수집하기</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>이상일(서울대학교 지리교육과 교수), 김세창(사회교육과 지리전공 석사), 김우형(사회교육과 지리전공 석사과정) </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">May 5, 2024</p>
    </div>
  </div>
    
  </div>
  


</header><section id="실습-개요" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="실습-개요">실습 개요</h2>
<p>이 실습은 R로 데이터를 수집하는 과정을 다룬다. R을 활용한 데이터 수집은 다양한 방법으로 진행될 수 있지만 여기서는 웹상의 데이터 파일 불러오기, 웹 스크레이핑, API를 이용하는 방식에 집중한다. 실습의 시작은&nbsp;<a href="https://www.tidyverse.org/"><code>tidyverse</code></a>&nbsp;패키지를 불러오는 것이다.</p>
</section><section id="웹상의-데이터-파일-불러오기" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="웹상의-데이터-파일-불러오기">
<span class="header-section-number">1</span> 웹상의 데이터 파일 불러오기</h2>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>아마도 데이터를 수집하는 가장 단순한 방법은 웹상에 파일 형태로 존재하는 데이터를 R에서 불러오는 것일 것이다.&nbsp;<code>readr</code>&nbsp;패키지에서 제공하는 다양한 데이터 불러오기 함수(예:&nbsp;<a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_csv()</code></a>)를 데이터의 URL에 적용하면 손쉽게 데이터를 획득할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">students</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://pos.it/r4ds-students-csv"</span><span class="op">)</span></span>
<span><span class="va">students</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  `Student ID` `Full Name`      favourite.food     mealPlan            AGE  
         &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;               &lt;chr&gt;
1            1 Sunil Huffmann   Strawberry yoghurt Lunch only          4    
2            2 Barclay Lynn     French fries       Lunch only          5    
3            3 Jayendra Lyne    N/A                Breakfast and lunch 7    
4            4 Leon Rossini     Anchovies          Lunch only          &lt;NA&gt; 
5            5 Chidiegwu Dunkel Pizza              Breakfast and lunch five 
6            6 Güvenç Attila    Ice cream          Lunch only          6    </code></pre>
</div>
</div>
<p>그런데 엑셀 형식의 파일은&nbsp;<a href="https://readxl.tidyverse.org/"><code>readxl</code></a>&nbsp;패키지가 제공하는&nbsp;<a href="https://readxl.tidyverse.org/reference/read_excel.html"><code>read_excel()</code></a>&nbsp;함수를 이용해 막바로 데이터를 불러오는 것이 불가능하다. <a href="https://ycphs.github.io/openxlsx/"><code>openxlsx</code></a>&nbsp;패키지는 이러한 문제를 해결할 수 있게 해준다. 정말 다양한 함수를 제공하지만&nbsp;<a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html"><code>read.xlsx()</code></a>&nbsp;함수가 URL을 통해 엑셀 데이터를 불러오는데 사용된다.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a></span><span class="op">)</span></span>
<span><span class="va">xlsx_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"https://github.com/awalker89/openxlsx/raw/master/inst/readTest.xlsx"</span><span class="op">)</span></span>
<span><span class="va">xlsx_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Var1 Var2   Var3 Var4  Var5         Var6 Var7
1   TRUE    1   1.00    a 42042 3209324 This   NA
2   TRUE   NA     NA    b 42041         &lt;NA&gt;   NA
3   TRUE    2   1.34    c 42040         &lt;NA&gt;   NA
4  FALSE    2     NA &lt;NA&gt;    NA         &lt;NA&gt;   NA
5  FALSE    3   1.56    e    NA         &lt;NA&gt;   NA
6  FALSE    1   1.70    f 42037         &lt;NA&gt;   NA
7     NA   NA     NA &lt;NA&gt; 42036         &lt;NA&gt;   NA
8  FALSE    2  23.00    h 42035         &lt;NA&gt;   NA
9  FALSE    3  67.30    i 42034         &lt;NA&gt;   NA
10    NA    1 123.00 &lt;NA&gt; 42033         &lt;NA&gt;   NA</code></pre>
</div>
</div>
</section><section id="웹스크레이핑" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="웹스크레이핑">
<span class="header-section-number">2</span> 웹스크레이핑</h2>
<p>웹스크레이핑(web scraping)이란 웹페이지로부터 특정한 데이터를 추출하는 것을 의미한다. R에서 웹스크레이핑은 <code>rvest</code> 패키지가 답당하는데, <code>reaxl</code> 패키지와 마찬가지로 <code>tidyverse</code>의 핵심 패키지는 아니기 때문에 따로 불러와야 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="웹스크레이핑의-실제-1-테이블이-하나-있는-경우" class="level3" data-number="2.1"><h3 data-number="2.1" class="anchored" data-anchor-id="웹스크레이핑의-실제-1-테이블이-하나-있는-경우">
<span class="header-section-number">2.1</span> 웹스크레이핑의 실제 1: 테이블이 하나 있는 경우</h3>
<p>위키피디어의 한 항목(List of countries and dependencies by population)에는 표 하나가 포함되어 있다. 해당 표의 데이터를 수집한다.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_population"</span></span>
<span><span class="va">my_table</span> <span class="op">&lt;-</span> <span class="va">url</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_element</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">my_table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 241 × 7
   ``      Location    Population `% ofworld` Date  Source (official or …¹ ``   
   &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                  &lt;chr&gt;
 1 –       World       8,104,769… 100%        5 Ma… UN projection[3]       ""   
 2 1/2 [b] China       1,409,670… 17.4%       31 D… Official estimate[5]   "[c]"
 3 1/2 [b] India       1,400,744… 17.3%       1 Ma… Official projection[6] "[d]"
 4 3       United Sta… 335,893,2… 4.1%        1 Ja… Official estimate[7]   "[e]"
 5 4       Indonesia   279,118,8… 3.4%        1 Ju… National annual proje… ""   
 6 5       Pakistan    241,499,4… 3.0%        1 Ma… 2023 census result[9]  "[f]"
 7 6       Nigeria     223,800,0… 2.8%        1 Ju… Official projection[1… ""   
 8 7       Brazil      203,080,7… 2.5%        1 Au… 2022 census result[11] ""   
 9 8       Bangladesh  169,828,9… 2.1%        14 J… 2022 census result[12] ""   
10 9       Russia      146,150,7… 1.8%        1 Ja… Official estimate[13]  "[g]"
# ℹ 231 more rows
# ℹ abbreviated name: ¹​`Source (official or fromthe United Nations)`</code></pre>
</div>
</div>
<p>수집한 데이터를 가공해본다. 필요없는 컬럼을 제거하고, 컬럼 이름을 바꾸고, 몇몇 변수를 특정 형태의 타입(numeric, date)으로 변환하기 위한 과정이다.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_table</span> <span class="op">&lt;-</span> <span class="va">my_table</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">7</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"Location"</span>,</span>
<span>    population <span class="op">=</span> <span class="st">"Population"</span>,</span>
<span>    pop_pct <span class="op">=</span> <span class="st">"% ofworld"</span>,</span>
<span>    date <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"Source (official or fromthe United Nations)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">population</span>, <span class="st">","</span><span class="op">)</span>,</span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span>,</span>
<span>    pop_pct <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">pop_pct</span>, <span class="st">"%"</span><span class="op">)</span>,</span>
<span>    pop_pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">pop_pct</span><span class="op">)</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">my_table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 241 × 5
   location      population pop_pct date       source                       
   &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;                        
 1 World         8104769000   100   2024-05-05 UN projection[3]             
 2 China         1409670000    17.4 2023-12-31 Official estimate[5]         
 3 India         1400744000    17.3 2024-03-01 Official projection[6]       
 4 United States  335893238     4.1 2024-01-01 Official estimate[7]         
 5 Indonesia      279118866     3.4 2023-07-01 National annual projection[8]
 6 Pakistan       241499431     3   2023-03-01 2023 census result[9]        
 7 Nigeria        223800000     2.8 2023-07-01 Official projection[10]      
 8 Brazil         203080756     2.5 2022-08-01 2022 census result[11]       
 9 Bangladesh     169828911     2.1 2022-06-14 2022 census result[12]       
10 Russia         146150789     1.8 2024-01-01 Official estimate[13]        
# ℹ 231 more rows</code></pre>
</div>
</div>
</section><section id="웹스크레이핑의-실제-2-테이블이-둘-이상인-경우" class="level3" data-number="2.2"><h3 data-number="2.2" class="anchored" data-anchor-id="웹스크레이핑의-실제-2-테이블이-둘-이상인-경우">
<span class="header-section-number">2.2</span> 웹스크레이핑의 실제 2: 테이블이 둘 이상인 경우</h3>
<p>위키피디아의 한 항목(List of FIPS country codes)에는 동일한 내용에 대해 여러 개의 표가 나타나 있다. 개별 표의 데이터를 수집한 후 결합하여 단일한 데이터 프레임을 구성한다.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_FIPS_country_codes"</span></span>
<span><span class="va">my_tables</span> <span class="op">&lt;-</span> <span class="va">url</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_elements</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">my_tables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 283 × 10
   Code    `Short-form name` .mw-parser-output .n…¹ .mw-parser-output .n…² ...3 
   &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;                  &lt;chr&gt;                  &lt;chr&gt;
 1 .mw-pa… Aruba             &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 2 AC      Antigua and Barb… &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 3 AE      United Arab Emir… &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 4 AF      Afghanistan       &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 5 AG      Algeria           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 6 AJ      Azerbaijan        &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 7 AL      Albania           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 8 AM      Armenia           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 9 AN      Andorra           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
10 AO      Angola            &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
# ℹ 273 more rows
# ℹ abbreviated names:
#   ¹​`.mw-parser-output .navbar{display:inline;font-size:88%;font-weight:normal}.mw-parser-output .navbar-collapse{float:left;text-align:left}.mw-parser-output .navbar-boxtext{word-spacing:0}.mw-parser-output .navbar ul{display:inline-block;white-space:nowrap;line-height:inherit}.mw-parser-output .navbar-brackets::before{margin-right:-0.125em;content:"[ "}.mw-parser-output .navbar-brackets::after{margin-left:-0.125em;content:" ]"}.mw-parser-output .navbar li{word-spacing:-0.125em}.mw-parser-output .navbar a&gt;span,.mw-parser-output .navbar a&gt;abbr{text-decoration:inherit}.mw-parser-output .navbar-mini abbr{font-variant:small-caps;border-bottom:none;text-decoration:none;cursor:inherit}.mw-parser-output .navbar-ct-full{font-size:114%;margin:0 7em}.mw-parser-output .navbar-ct-mini{font-size:114%;margin:0 4em}vteGeocode systems...1`,
#   ²​`.mw-parser-output .navbar{display:inline;font-size:88%;font-weight:normal}.mw-parser-output .navbar-collapse{float:left;text-align:left}.mw-parser-output .navbar-boxtext{word-spacing:0}.mw-parser-output .navbar ul{display:inline-block;white-space:nowrap;line-height:inherit}.mw-parser-output .navbar-brackets::before{margin-right:-0.125em;content:"[ "}.mw-parser-output .navbar-brackets::after{margin-left:-0.125em;content:" ]"}.mw-parser-output .navbar li{word-spacing:-0.125em}.mw-parser-output .navbar a&gt;span,.mw-parser-output .navbar a&gt;abbr{text-decoration:inherit}.mw-parser-output .navbar-mini abbr{font-variant:small-caps;border-bottom:none;text-decoration:none;cursor:inherit}.mw-parser-output .navbar-ct-full{font-size:114%;margin:0 7em}.mw-parser-output .navbar-ct-mini{font-size:114%;margin:0 4em}vteGeocode systems...2`
# ℹ 5 more variables: ...4 &lt;chr&gt;, ...5 &lt;chr&gt;, ...6 &lt;chr&gt;, X1 &lt;chr&gt;, X2 &lt;chr&gt;</code></pre>
</div>
</div>
<p>수집한 데이터를 약간 가공한다. 역시 필요한 컬럼만 남기고, 이름을 바꿔준다. 마지막 <code>str_extract</code>는 Aruba의 단축어에 원치 않는 문자열이 추가되어 있어 제거하기 위한 코드이다.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_tables</span> <span class="op">&lt;-</span> <span class="va">my_tables</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>    code <span class="op">=</span> <span class="st">"Code"</span>, </span>
<span>    short_name <span class="op">=</span> <span class="st">"Short-form name"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    code <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">code</span>, <span class="st">"[A-Z][A-Z]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">my_tables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 283 × 2
   code  short_name          
   &lt;chr&gt; &lt;chr&gt;               
 1 AA    Aruba               
 2 AC    Antigua and Barbuda 
 3 AE    United Arab Emirates
 4 AF    Afghanistan         
 5 AG    Algeria             
 6 AJ    Azerbaijan          
 7 AL    Albania             
 8 AM    Armenia             
 9 AN    Andorra             
10 AO    Angola              
# ℹ 273 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
추가 예제
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>간혹 테이블을 불러올 때 데이터가 깨지는 경우도 발생한다. 이는 인코딩 방식의 문제인데, 아래와 같이 인코딩 아규먼트를 추가하면 해결된다. 보통 “EUC-KR”이나 “UTF-8” 둘 중 하나는 제대로 작동한다.</p>
<p>한 번 네이버가 제공하는 주식 거래 상위 품목을 크롤링해보자.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span></span>
<span><span class="va">kospi</span> <span class="op">&lt;-</span> <span class="st">"https://finance.naver.com/sise/sise_quant.naver?sosok=0"</span></span>
<span></span>
<span><span class="va">kospi_table</span> <span class="op">&lt;-</span> <span class="va">kospi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span>, encoding <span class="op">=</span> <span class="st">"EUC-KR"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_elements</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="va">_</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">kospi_table</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7b0da126070054e7ca58" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7b0da126070054e7ca58">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],["KODEX 200선물인버스2X","대원전선","KODEX 코스닥150레버리지","KODEX 코스닥150선물인버스","KODEX 인버스","KODEX 레버리지","삼성 인버스 2X WTI원유 선물 ETN","신한 인버스 2X WTI원유 선물 ETN(H)","비에이치","삼성전자","한국석유","조일알미늄","신풍","아센디오","비케이탑스","흥아해운","KODEX 코스닥150","한국ANKOR유전","KIB플러그에너지","계양전기","대한전선","삼성중공업","한온시스템","모나리자","일진다이아","KODEX 200","삼성 인버스 2X 코스닥150 선물 ETN","QV 블룸버그 2X 천연가스 선물 ETN(H)","에이프로젠","금호타이어","대양금속","두산에너빌리티","삼부토건","티웨이항공","TIGER 미국S&amp;P500","TIGER 차이나항셍테크","KODEX 2차전지산업레버리지","삼성 레버리지 천연가스 선물 ETN C","SK하이닉스","NAVER","삼화전기","한화솔루션","KODEX AI반도체핵심장비","TIGER Fn반도체TOP10","한화시스템","기아","TIGER 200선물인버스2X","KODEX 차이나H레버리지(H)","HMM","TIGER 차이나전기차SOLACTIVE","에어부산","TIGER 미국필라델피아반도체나스닥","이구산업","이수페타시스","한컴라이프케어","한화투자증권","대원전선우","일진전기","ACE 미국30년국채액티브(H)","광명전기","후성","카카오","TIGER 화장품","TIGER AI반도체핵심공정","디아이","KODEX 미국달러선물인버스2X","대한해운","KODEX KOFR금리액티브(합성)","제주은행","제이준코스메틱","한화생명","현대로템","한화엔진","SK이터닉스","코오롱모빌리티그룹","KODEX 미국S&amp;P500TR","하이트론","핸즈코퍼레이션","이엔플러스","한화갤러리아","삼화전자","BNK금융지주","대창","STX","LG디스플레이","KODEX 미국S&amp;P500(H)","TIGER 200","팬오션","한화오션","알루코","KOSEF 200","풍산","일진홀딩스","한미반도체","KB금융","삼성 레버리지 WTI원유 선물 ETN","TIGER 미국배당다우존스","신한 레버리지 WTI원유 선물 ETN(H)","QV 인버스 레버리지 WTI원유 선물 ETN(H)","넥센타이어"],["2,100","3,210","11,720","3,430","4,220","18,935","95","81","20,700","77,600","17,150","2,350","941","1,063","53","2,595","14,245","358","405","2,380","13,080","9,390","6,490","3,790","18,910","36,485","5,940","362","1,488","8,190","1,416","16,550","1,518","2,930","17,240","5,970","3,865","5,250","173,200","194,600","67,300","26,500","13,285","12,585","19,140","113,900","2,235","1,744","15,310","8,200","2,965","16,690","6,200","39,000","6,150","3,195","6,820","20,800","8,125","2,660","7,350","49,200","2,855","12,760","19,750","6,035","1,795","106,670","13,650","7,710","2,850","37,950","12,030","18,050","3,530","15,700","1,235","2,800","3,515","1,423","4,405","8,500","1,485","8,250","10,550","11,965","36,555","4,175","31,000","3,315","36,430","74,900","4,255","130,000","73,700","1,528","11,300","1,062","75","8,470"],["보합0","하락\n\t\t\t\t190","하락\n\t\t\t\t125","상승\n\t\t\t\t20","상승\n\t\t\t\t5","하락\n\t\t\t\t5","상승\n\t\t\t\t1","상승\n\t\t\t\t1","상승\n\t\t\t\t3,060","하락\n\t\t\t\t400","상승\n\t\t\t\t2,050","상승\n\t\t\t\t60","상승\n\t\t\t\t72","상승\n\t\t\t\t61","하락\n\t\t\t\t7","상승\n\t\t\t\t50","하락\n\t\t\t\t90","상승\n\t\t\t\t4","보합0","하락\n\t\t\t\t175","하락\n\t\t\t\t410","하락\n\t\t\t\t40","상승\n\t\t\t\t620","상승\n\t\t\t\t50","상승\n\t\t\t\t890","하락\n\t\t\t\t30","상승\n\t\t\t\t50","상승\n\t\t\t\t12","상승\n\t\t\t\t4","상승\n\t\t\t\t360","상승\n\t\t\t\t33","상승\n\t\t\t\t50","하락\n\t\t\t\t36","상승\n\t\t\t\t15","하락\n\t\t\t\t50","상승\n\t\t\t\t100","하락\n\t\t\t\t30","상승\n\t\t\t\t190","하락\n\t\t\t\t400","상승\n\t\t\t\t5,800","상승\n\t\t\t\t4,600","상승\n\t\t\t\t550","상승\n\t\t\t\t10","하락\n\t\t\t\t30","하락\n\t\t\t\t550","하락\n\t\t\t\t5,700","상승\n\t\t\t\t5","상승\n\t\t\t\t56","하락\n\t\t\t\t290","상승\n\t\t\t\t55","상승\n\t\t\t\t185","상승\n\t\t\t\t50","하락\n\t\t\t\t330","하락\n\t\t\t\t1,400","상승\n\t\t\t\t170","상승\n\t\t\t\t25","하락\n\t\t\t\t510","하락\n\t\t\t\t900","상승\n\t\t\t\t25","하락\n\t\t\t\t70","하락\n\t\t\t\t340","상승\n\t\t\t\t900","상승\n\t\t\t\t35","하락\n\t\t\t\t20","상승\n\t\t\t\t500","상승\n\t\t\t\t110","하락\n\t\t\t\t2","상승\n\t\t\t\t40","하락\n\t\t\t\t140","상승\n\t\t\t\t710","하락\n\t\t\t\t45","하락\n\t\t\t\t300","하락\n\t\t\t\t230","하락\n\t\t\t\t1,100","상승\n\t\t\t\t165","하락\n\t\t\t\t50","상승\n\t\t\t\t74","하락\n\t\t\t\t15","하락\n\t\t\t\t170","상승\n\t\t\t\t1","하락\n\t\t\t\t105","상승\n\t\t\t\t130","하락\n\t\t\t\t25","상승\n\t\t\t\t350","상승\n\t\t\t\t170","상승\n\t\t\t\t75","하락\n\t\t\t\t15","상승\n\t\t\t\t40","하락\n\t\t\t\t200","하락\n\t\t\t\t5","하락\n\t\t\t\t20","상승\n\t\t\t\t2,200","하락\n\t\t\t\t110","하락\n\t\t\t\t3,000","상승\n\t\t\t\t1,400","하락\n\t\t\t\t30","하락\n\t\t\t\t40","하락\n\t\t\t\t11","상승\n\t\t\t\t2","하락\n\t\t\t\t550"],["0.00%","-5.59%","-1.06%","+0.59%","+0.12%","-0.03%","+1.06%","+1.25%","+17.35%","-0.51%","+13.58%","+2.62%","+8.29%","+6.09%","-11.67%","+1.96%","-0.63%","+1.13%","0.00%","-6.85%","-3.04%","-0.42%","+10.56%","+1.34%","+4.94%","-0.08%","+0.85%","+3.43%","+0.27%","+4.60%","+2.39%","+0.30%","-2.32%","+0.51%","-0.29%","+1.70%","-0.77%","+3.75%","-0.23%","+3.07%","+7.34%","+2.12%","+0.08%","-0.24%","-2.79%","-4.77%","+0.22%","+3.32%","-1.86%","+0.68%","+6.65%","+0.30%","-5.05%","-3.47%","+2.84%","+0.79%","-6.96%","-4.15%","+0.31%","-2.56%","-4.42%","+1.86%","+1.24%","-0.16%","+2.60%","+1.86%","-0.11%","+0.04%","-1.02%","+10.14%","-1.55%","-0.78%","-1.88%","-5.74%","+4.90%","-0.32%","+6.37%","-0.53%","-4.61%","+0.07%","-2.33%","+1.55%","-1.66%","+4.43%","+1.64%","+0.63%","-0.04%","+0.97%","-0.64%","-0.15%","-0.05%","+3.03%","-2.52%","-2.26%","+1.94%","-1.93%","-0.35%","-1.03%","+2.74%","-6.10%"],["98,757,087","36,653,272","21,506,173","21,052,013","19,452,454","16,750,604","15,274,608","14,717,561","14,705,798","13,056,919","12,984,410","11,933,806","9,348,483","8,552,068","8,505,645","7,902,727","7,155,405","5,623,201","5,234,056","4,688,885","4,558,768","4,452,918","4,428,320","3,993,299","3,805,999","3,628,387","3,545,643","3,293,496","3,076,621","2,962,801","2,736,607","2,725,526","2,568,067","2,508,920","2,431,832","2,430,652","2,366,125","2,362,595","2,299,485","2,278,628","2,140,086","1,920,905","1,917,087","1,889,523","1,857,068","1,768,896","1,723,623","1,679,332","1,674,888","1,589,233","1,532,874","1,530,150","1,495,841","1,486,869","1,475,645","1,466,502","1,432,114","1,421,701","1,418,579","1,386,323","1,378,058","1,368,687","1,331,840","1,324,236","1,257,647","1,253,681","1,246,913","1,244,562","1,231,949","1,231,670","1,212,459","1,205,866","1,204,569","1,200,117","1,199,728","1,181,651","1,161,680","1,138,622","1,123,212","1,100,753","1,070,323","1,064,944","1,048,968","1,046,462","1,002,671","995,966","990,245","984,676","979,310","979,197","969,330","967,422","967,179","958,389","934,198","932,864","928,407","921,154","906,236","900,495"],["205,846","124,330","255,501","71,693","81,709","320,213","1,437","1,192","298,090","1,021,173","223,016","28,266","9,327","9,434","439","20,761","102,573","2,045","2,106","11,563","60,775","41,915","27,631","15,623","74,290","132,894","20,779","1,196","4,584","23,975","3,775","44,999","3,925","7,280","42,047","14,579","9,183","12,480","402,448","442,906","146,448","51,629","25,723","23,950","35,800","205,499","3,813","2,944","25,736","13,106","4,500","25,591","9,418","59,207","8,950","4,718","9,990","30,215","11,529","3,721","10,286","67,626","3,771","17,020","23,845","7,543","2,247","132,751","16,919","10,147","3,458","46,065","14,553","22,131","4,161","18,597","1,519","3,518","4,012","1,571","4,839","9,014","1,566","8,640","10,631","11,922","36,318","4,086","30,403","3,258","35,467","71,173","4,231","126,926","69,310","1,429","10,504","979","67","7,668"],["2,100","3,205","11,715","3,425","4,215","18,930","94","81","20,700","77,600","17,150","2,345","940","1,062","53","2,595","14,240","357","405","2,380","13,080","9,380","6,480","3,790","18,900","36,485","5,940","362","1,488","8,190","1,416","16,550","1,518","2,925","17,235","5,965","3,860","5,250","173,200","194,600","67,300","26,500","13,280","12,580","19,140","113,800","2,230","1,744","15,310","8,195","2,965","16,685","6,200","38,950","6,140","3,195","6,810","20,800","8,120","2,660","7,350","49,200","2,855","12,760","19,750","6,035","1,794","106,665","13,650","7,700","2,845","37,950","12,020","18,050","3,525","15,695","1,234","2,780","3,515","1,422","4,405","8,490","1,485","8,240","10,550","11,960","36,550","4,175","30,950","3,315","36,430","74,800","4,255","130,000","73,600","1,527","11,300","1,061","74","8,460"],["2,105","3,210","11,720","3,430","4,220","18,935","95","82","20,750","77,700","17,160","2,350","941","1,063","54","2,600","14,245","358","406","2,385","13,090","9,390","6,490","3,805","18,910","36,490","5,945","363","1,489","8,200","1,417","16,560","1,519","2,930","17,240","5,970","3,865","5,255","173,300","194,700","67,400","26,600","13,285","12,585","19,150","113,900","2,235","1,745","15,320","8,200","2,970","16,690","6,210","39,000","6,150","3,200","6,820","20,850","8,125","2,665","7,360","49,250","2,860","12,765","19,760","6,040","1,795","106,670","13,660","7,710","2,850","38,000","12,030","18,090","3,530","15,700","1,235","2,800","3,520","1,423","4,410","8,500","1,486","8,250","10,560","11,965","36,555","4,180","31,000","3,320","36,440","74,900","4,260","130,100","73,700","1,528","11,305","1,062","75","8,470"],["13,688","2,407","10,196","4,390","5,693","20,052","1,422","513","7,134","4,632,551","2,177","2,976","329","1,101","11","6,239","8,504","251","960","648","24,387","82,632","34,644","1,386","2,686","62,006","2,376","214","3,941","23,527","561","106,013","3,219","6,311","31,523","6,328","1,836","2,100","1,260,900","316,047","4,451","45,552","2,385","8,256","36,159","457,928","847","851","105,492","20,802","3,458","22,565","2,073","24,666","1,702","6,855","179","9,919","11,286","1,153","7,883","219,060","1,424","1,359","5,589","1,495","5,729","52,349","4,386","346","24,753","41,420","10,039","4,614","2,216","10,276","341","613","2,465","2,759","745","27,378","1,353","2,559","52,750","2,196","21,695","22,318","94,971","3,205","3,370","20,990","2,100","126,541","297,388","6,173","8,334","5,310","112","8,272"],["N/A","24.88","N/A","N/A","N/A","N/A","N/A","N/A","7.87","36.41","14.66","-2,350.00","-5.06","-3.60","-0.08","18.27","N/A","N/A","6.53","-54.09","25.65","-55.89","67.60","15.16","26.86","N/A","N/A","N/A","-6.89","14.92","-1.79","190.23","-2.76","6.13","N/A","N/A","N/A","N/A","-13.84","31.49","80.12","-22.61","N/A","N/A","10.35","5.23","N/A","N/A","8.37","N/A","3.32","N/A","310.00","51.66","205.00","76.07","52.87","23.88","N/A","11.32","-13.27","-21.62","N/A","N/A","177.93","N/A","8.39","N/A","85.85","-4.96","3.26","25.73","-2,005.00","N/A","18.10","N/A","-3.18","-2.03","-3.89","-7.78","-9.79","4.31","-6.97","-4.56","-1.53","N/A","N/A","9.12","40.95","16.57","N/A","13.42","7.65","47.36","6.44","N/A","N/A","N/A","N/A","8.58"],["N/A","10.02","N/A","N/A","N/A","N/A","N/A","N/A","15.11","4.15","8.67","-0.07","-8.53","-88.87","-228.88","23.02","N/A","N/A","N/A","-1.02","7.83","-4.22","2.21","11.51","2.48","N/A","N/A","N/A","-30.65","13.20","-36.88","0.78","-73.88","91.56","N/A","N/A","N/A","N/A","-15.61","4.41","7.92","-2.48","N/A","N/A","16.87","20.44","N/A","N/A","4.59","N/A","66.45","N/A","0.52","19.51","0.65","0.59","N/A","9.65","N/A","8.69","-15.89","-10.26","N/A","N/A","2.09","N/A","4.36","N/A","0.97","-16.66","5.43","10.06","-0.19","N/A","N/A","N/A","-136.62","-13.54","-81.19","N/A","-32.47","6.38","-8.32","-73.98","-31.95","N/A","N/A","5.32","6.33","7.19","N/A","8.22","6.21","55.54","8.44","N/A","N/A","N/A","N/A","6.26"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>N<\/th>\n      <th>종목명<\/th>\n      <th>현재가<\/th>\n      <th>전일비<\/th>\n      <th>등락률<\/th>\n      <th>거래량<\/th>\n      <th>거래대금<\/th>\n      <th>매수호가<\/th>\n      <th>매도호가<\/th>\n      <th>시가총액<\/th>\n      <th>PER<\/th>\n      <th>ROE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"N","targets":1},{"name":"종목명","targets":2},{"name":"현재가","targets":3},{"name":"전일비","targets":4},{"name":"등락률","targets":5},{"name":"거래량","targets":6},{"name":"거래대금","targets":7},{"name":"매수호가","targets":8},{"name":"매도호가","targets":9},{"name":"시가총액","targets":10},{"name":"PER","targets":11},{"name":"ROE","targets":12}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="api의-활용" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="api의-활용">
<span class="header-section-number">3</span> API의 활용</h2>
<p>KOSIS를 포함한 많은 대한민국의 데이터 포털은 개방 API 서비스를 제공하고 있다. KOSIS는 공유서비스 홈페이지(<a href="https://kosis.kr/openapi/index.jsp">https://kosis.kr/openapi/</a>)를 통해 Open API를 통한 데이터 수집을 권장하고 있다.</p>
<p>앞에서 설명한 것처럼, API용 패키지를 직접 사용할 수도 있지만, 래퍼 패키지가 존재하기만 한다면 그것을 활용하는 것이 훨씬 손쉬운 옵션일 수 있다. 놀랍게도 한국의 주석훈(Seokhoon Joo)이라는 분이 그러한 기능을 하는 <code>kosis</code>(<a href="https://cran.r-project.org/web/packages/kosis/">https://cran.r-project.org/web/packages/kosis/index.html</a>)라는 패키지를 이미 개발해 두었고, 그것을 활용하고자 한다.</p>
<p>실습 주제는 2022년 센서스 인구 기준으로 전국의 17개 시도별 ’지방소멸위험지수’를 계산하고 그래프의 형태로 표현하는 것이다.</p>
<section id="kosis에서-api-key-받기" class="level3" data-number="3.1"><h3 data-number="3.1" class="anchored" data-anchor-id="kosis에서-api-key-받기">
<span class="header-section-number">3.1</span> KOSIS에서 API KEY 받기</h3>
<p>먼저 API를 활용하기 위해 기관으로부터 KEY를 발급받아야 한다. 이를 위해 통계청에 회원가입을 한 후, KEY를 요청해야 한다. 과정은 아래와 같다.</p>
<ul>
<li><p>KOSIS 공유서비스 웹페이지(<a href="https://kosis.kr/openapi/" class="uri">https://kosis.kr/openapi/</a>) 접속</p></li>
<li>
<p>상단의 [활용신청] 탭 클릭</p>
<ul>
<li>통계청의 ONE-ID로 통합로그인(없으면 회원가입 필수)</li>
</ul>
</li>
<li>
<p>활용신청하여 사용자 인증키 획득</p>
<ul>
<li>사용자 인증키는 마이페이지에서 언제든 확인 가능</li>
</ul>
</li>
</ul></section><section id="패키지-설치-및-인증키-등록" class="level3" data-number="3.2"><h3 data-number="3.2" class="anchored" data-anchor-id="패키지-설치-및-인증키-등록">
<span class="header-section-number">3.2</span> 패키지 설치 및 인증키 등록</h3>
<p>우선&nbsp;<code>kosis</code>&nbsp;패키지를 오른쪽 하단 윈도우의 Packages 탭을 활용하여 인스톨한다. 이후에 아래와 같이&nbsp;<code>kosis</code>와&nbsp;<code>tidyverse</code>&nbsp;패키지를 불러온다.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kosis</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다음으로, <code>kosis</code> 패키지의&nbsp;<a href="https://rdrr.io/pkg/kosis/man/kosis.setKey.html"><code>kosis.setKey()</code></a>&nbsp;함수를 이용하여 인증키를 등록한다. Your Key Here 자리에 부여받은 인증키를 붙여 넣는다.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/kosis/man/kosis.setKey.html">kosis.setKey</a></span><span class="op">(</span>apiKey <span class="op">=</span> <span class="st">"Your Key Here"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="데이터-추출" class="level3" data-number="3.3"><h3 data-number="3.3" class="anchored" data-anchor-id="데이터-추출">
<span class="header-section-number">3.3</span> 데이터 추출</h3>
<p>이제 통계청 홈페이지에 접속해서 데이터를 불러와본다. 과정은 아래와 같다.</p>
<ul>
<li><p>KOSIS에 접속 후 로그인</p></li>
<li>
<p>데이터에 접근 후 URL 생성</p>
<ul>
<li><p>[국내통계]-[주제별 통계]-[인구]-[인구총조사]-[인구부문]-[총조사인구(2015년 이후)]-[전수부문 (등록센서스, 2015년 이후)]-[전수기본표]-[연령 및 성별 인구]</p></li>
<li><p><strong>항목</strong>: ‘총인구(명)’, ‘총인구_남자(명)’, ’총인구_여자(명)’만 선택(더 많은 항목을 선택하면 데이터가 너무 커 에러가 발생)</p></li>
<li><p><strong>행정구역별(읍면동)</strong>: ‘1 레벨’과 ’2 레벨’ 선택(’1 레벨’은 시도 수준, ’2 레벨’은 시군구 수준)</p></li>
<li><p><strong>조회기간</strong>: ‘기간설정’ 버턴을 누른 후, 기간설정이 2022~2022년인지 확인한다.</p></li>
<li><p><strong>응답필드</strong>: 하나씩 눌러 모두 선택한 후, ‘URL생성’ 탭을 클릭한다. 그리고 나서 ‘URL 복사’ 탭을 클릭한다. URL 속에 api key가 포함되어 있음을 확인한</p></li>
</ul>
</li>
<li><p>생성한 URL로부터 데이터 획득</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">your_url</span> <span class="op">&lt;-</span> <span class="st">"Your URL"</span></span>
<span><span class="va">data_api</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kosis/man/getStatDataFromURL.html">getStatDataFromURL</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">your_url</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>getStatDataFromURL</code> 함수의 아규먼트에 위에서 생성한 URL을 입력하면, 다운로드 과정 없이 곧바로 데이터를 획득할 수 있다.</p>
</section><section id="데이터-정리-및-변형" class="level3" data-number="3.4"><h3 data-number="3.4" class="anchored" data-anchor-id="데이터-정리-및-변형">
<span class="header-section-number">3.4</span> 데이터 정리 및 변형</h3>
<p>아래와 같이 데이터를 정리 및 변형한다. 최종적으로 지역별 지역소멸위험지수를 산출한다.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_api</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">C2</span>, <span class="va">C2_NM</span>, <span class="va">ITM_ID</span>, <span class="va">ITM_NM</span>, <span class="va">DT</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">DT</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span>,</span>
<span>    ITM_ID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span></span>
<span>    <span class="va">ITM_ID</span>, <span class="st">"T00"</span> <span class="op">~</span> <span class="st">"T"</span>,</span>
<span>    <span class="st">"T01"</span> <span class="op">~</span> <span class="st">"M"</span>,</span>
<span>    <span class="st">"T02"</span> <span class="op">~</span> <span class="st">"F"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"gender_age"</span>, <span class="va">ITM_ID</span>, <span class="va">C2_NM</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">C1_NM</span><span class="op">)</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">gender_age</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">DT</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    index <span class="op">=</span> <span class="op">(</span><span class="va">`F_20~24세`</span> <span class="op">+</span> <span class="va">`F_25~29세`</span> <span class="op">+</span> <span class="va">`F_30~34세`</span> <span class="op">+</span> <span class="va">`F_35~39세`</span><span class="op">)</span> <span class="op">/</span> <span class="va">`T_65세이상`</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">index</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>시도 데이터와 시군구 데이터를 분리하여 저장한다.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_sido</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">data_sgg</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">C1</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">C1_NM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"동부"</span>, <span class="st">"면부"</span>, <span class="st">"읍부"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="그래프-작성" class="level3" data-number="3.5"><h3 data-number="3.5" class="anchored" data-anchor-id="그래프-작성">
<span class="header-section-number">3.5</span> 그래프 작성</h3>
<p>인구소멸위험지수 연구에서 주로 사용되는 5개의 위험도 클래스의 구분법을 적용하고, 위험도 클래스별로 특정한 색상을 적용하고, 그래프의 범례에 5개의 클래스가 모두 나타나게 하려다보니 코드가 조금 복잡해졌다.&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_sido</span> <span class="op">&lt;-</span> <span class="va">data_sido</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    index_class <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">index</span> <span class="op">&lt;</span> <span class="fl">0.2</span> <span class="op">~</span> <span class="st">"1"</span>,</span>
<span>      <span class="va">index</span> <span class="op">&gt;=</span> <span class="fl">0.2</span> <span class="op">&amp;</span> <span class="va">index</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"2"</span>,</span>
<span>      <span class="va">index</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">index</span> <span class="op">&lt;</span> <span class="fl">1.0</span> <span class="op">~</span> <span class="st">"3"</span>,</span>
<span>      <span class="va">index</span> <span class="op">&gt;=</span> <span class="fl">1.0</span> <span class="op">&amp;</span> <span class="va">index</span> <span class="op">&lt;</span> <span class="fl">1.5</span> <span class="op">~</span> <span class="st">"4"</span>,</span>
<span>      <span class="va">index</span> <span class="op">&gt;=</span> <span class="fl">1.5</span> <span class="op">~</span> <span class="st">"5"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    index_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">index_class</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">class_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"#d7191c"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"#fdae61"</span>,</span>
<span>                 <span class="st">"3"</span> <span class="op">=</span> <span class="st">"#ffffbf"</span>, <span class="st">"4"</span> <span class="op">=</span> <span class="st">"#a6d96a"</span>, </span>
<span>                 <span class="st">"5"</span> <span class="op">=</span> <span class="st">"#1a9641"</span><span class="op">)</span></span>
<span><span class="va">data_sido</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">C1_NM</span>, <span class="va">index</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">index_class</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">index</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                               nsmall <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Classes"</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 0.2"</span>, <span class="st">"0.2 ~ 0.5"</span>, <span class="st">"0.5 ~ 1.0"</span>, </span>
<span>                               <span class="st">"1.0 ~ 1.5"</span>, <span class="st">"&gt;= 1.5"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="va">class_color</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"인구소멸위험지수, 2022년"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"인구소멸위험지수"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="lab_07_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
KOSIS API의 추가 예제
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>이렇게 KOSIS 홈페이지에서 URL을 직접 지정하지 않고도 데이터를 불러오는 방법이 있다. <code>getStatData</code> 함수로, 기관명과 데이터 코드를 아규먼트에 입력하면 해당 데이터를 불러올 수 있다. 가령 방금 실습에서 사용한 데이터는 통계청의 2015년 인구총조사 전수부문의 연령 및 성별인구에 해당한다. 이때 통계청의 기관 코드는 <u><strong>101</strong></u>, 해당 데이터의 코드는 <u><strong>DT_1IN503</strong></u>이다.</p>
<p>아래의 코드는 여기에 몇 개의 아규먼트를 더 추가하여 서울특별시 종로구의 2015년부터 2022년까지의 데이터를 불러오고, 이를 바탕으로 인구소멸지수를 계산하여 그 추이를 시각화 한 것이다.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">aoi_code</span> <span class="op">&lt;-</span> <span class="st">"11010"</span> <span class="co"># 서울특별시 종로구 코드</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kosis/man/getStatData.html">getStatData</a></span><span class="op">(</span>orgId <span class="op">=</span> <span class="fl">101</span>, tblId <span class="op">=</span> <span class="st">"DT_1IN1503"</span>, prdSe <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>                    startPrdDe <span class="op">=</span> <span class="st">"2015"</span>, endPrdDe <span class="op">=</span> <span class="st">"2022"</span>,</span>
<span>                    objL1 <span class="op">=</span> <span class="va">aoi_code</span>, objL2 <span class="op">=</span> <span class="st">"ALL"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">C2</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="va">aoi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">C2</span>, <span class="va">C2_NM</span>, <span class="va">ITM_ID</span>, <span class="va">ITM_NM</span>, <span class="va">DT</span>, <span class="va">PRD_DE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ITM_ID</span> <span class="op">==</span> <span class="st">"T00"</span> <span class="op">|</span> <span class="va">ITM_ID</span> <span class="op">==</span> <span class="st">"T01"</span> <span class="op">|</span> <span class="va">ITM_ID</span> <span class="op">==</span> <span class="st">"T02"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">DT</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span>,</span>
<span>    ITM_ID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">ITM_ID</span>, <span class="st">"T00"</span> <span class="op">~</span> <span class="st">"T"</span>,</span>
<span>      <span class="st">"T01"</span> <span class="op">~</span> <span class="st">"M"</span>,</span>
<span>      <span class="st">"T02"</span> <span class="op">~</span> <span class="st">"F"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"gender_age"</span>, <span class="va">ITM_ID</span>, <span class="va">C2_NM</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">PRD_DE</span><span class="op">)</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">gender_age</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">DT</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    index <span class="op">=</span> <span class="op">(</span><span class="va">`F_20~24세`</span> <span class="op">+</span> <span class="va">`F_25~29세`</span> <span class="op">+</span> <span class="va">`F_30~34세`</span> <span class="op">+</span> <span class="va">`F_35~39세`</span><span class="op">)</span> <span class="op">/</span> <span class="va">`T_65세이상`</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">index</span>, <span class="va">PRD_DE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="va">aoi</span><span class="op">$</span><span class="va">C1_NM</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">aoi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PRD_DE</span>, y<span class="op">=</span><span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">region</span>, <span class="st">" 인구소멸위험지수 추이"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"연도"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"인구소멸위험지수"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, hjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="lab_07_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>aoi_code</code>에 내가 원하는 지역의 코드를 넣으면 마찬가지로 해당 관심지역의 인구소멸위험지수 추이를 관측할 수 있다. 예컨대 인구가 빠르게 증가하는 경기 김포시는 “31230”, 화성시는 “31240”이고, 소멸지수가 가장 높은 경북 상주시는 “37080”, 경북 문경시는 “37090”이다. 제공한 코드에서 한번 <code>aoi_code</code> 부분만 변경해보자.</p>
<p>한편, 이렇게 URL 없이 데이터를 불러오는 경우 KOSIS에서 직접 조정하는 것에 비해 덜 번거롭지만 제한사항도 많다. 가령 복수의 지역을 불러오는 것이 반복문을 사용하지 않고서는 불가능하고, 불필요한 데이터를 빼고 가져오기도 어렵다. 그러나 startPrdDe와 endPrdDe 아규먼트를 이용해 데이터를 시계열로 수집하고자 하는 측면에서는 유용하다.</p>
<p>그러므로 수집하고자 하는 데이터를 잘 파악해서 API를 활용해보자.</p>
</div>
</div>
</div>
</section><section id="cf-kosis-api를-활용한-함수-작성" class="level3" data-number="3.6"><h3 data-number="3.6" class="anchored" data-anchor-id="cf-kosis-api를-활용한-함수-작성">
<span class="header-section-number">3.6</span> cf) KOSIS API를 활용한 함수 작성</h3>
<p>마지막으로, API를 활용한 함수를 소개한다. API를 신청할 때 보았듯, 이는 웹/앱 애플리케이션을 제작하기 위한 용도로 주로 사용된다.</p>
<p>이와 관련된 매우 간단한 예시로, 학생에게 인구소멸지수가 궁금한 지역을 검색해보도록 하는 활동을 구상한다고 가정해보자. 학생이 매번 코드를 작성하며 확인하기란 사실상 불가능하다. 그런데 위에서 사용한 코드와 API를 활용하면 함수를 어렵지 않게 생성할 수 있다.</p>
<p>예컨대 교사가 아래와 같이 <code>exInd()</code> 함수를 한번 작성해두면, 학생은 단 한 줄의 코드만 입력해도 금방 지역의 인구소멸지수의 추이를 탐색해볼 수 있을 것이다.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 함수 생성: 교사 작성 부분</span></span>
<span><span class="va">exInd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Library</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kosis</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a></span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Table for Searching Region Code</span></span>
<span>  <span class="va">region_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"https://github.com/Sechang-Kim/gis-lab/raw/download/korea-sigungu-code(2022).xlsx"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">region_table</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Input Arguments</span></span>
<span>  <span class="va">aoi_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readline.html">readline</a></span><span class="op">(</span><span class="st">'지역 코드를 입력하세요: '</span><span class="op">)</span></span>
<span>  <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html">readline</a></span><span class="op">(</span><span class="st">'시작 연도를 입력하세요: '</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html">readline</a></span><span class="op">(</span><span class="st">'종료 연도를 입력하세요: '</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Data Request</span></span>
<span>  <span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kosis/man/getStatData.html">getStatData</a></span><span class="op">(</span>orgId <span class="op">=</span> <span class="fl">101</span>, tblId <span class="op">=</span> <span class="st">"DT_1IN1503"</span>, prdSe <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>                     startPrdDe <span class="op">=</span> <span class="va">start</span>, endPrdDe <span class="op">=</span> <span class="va">end</span>,</span>
<span>                     objL1 <span class="op">=</span> <span class="va">aoi_code</span>, objL2 <span class="op">=</span> <span class="st">"ALL"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">C2</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># Delete 1-age interval(Only 5-age interval)</span></span>
<span>  </span>
<span>  <span class="co"># Data Cleansing</span></span>
<span>  <span class="va">aoi</span> <span class="op">&lt;-</span> <span class="va">aoi</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">C2</span>, <span class="va">C2_NM</span>, <span class="va">ITM_ID</span>, <span class="va">ITM_NM</span>, <span class="va">DT</span>, <span class="va">PRD_DE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ITM_ID</span> <span class="op">==</span> <span class="st">"T00"</span> <span class="op">|</span> <span class="va">ITM_ID</span> <span class="op">==</span> <span class="st">"T01"</span> <span class="op">|</span> <span class="va">ITM_ID</span> <span class="op">==</span> <span class="st">"T02"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">DT</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span>,</span>
<span>      ITM_ID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span></span>
<span>        <span class="va">ITM_ID</span>, <span class="st">"T00"</span> <span class="op">~</span> <span class="st">"T"</span>,</span>
<span>        <span class="st">"T01"</span> <span class="op">~</span> <span class="st">"M"</span>,</span>
<span>        <span class="st">"T02"</span> <span class="op">~</span> <span class="st">"F"</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"gender_age"</span>, <span class="va">ITM_ID</span>, <span class="va">C2_NM</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>      id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">PRD_DE</span><span class="op">)</span>,</span>
<span>      names_from <span class="op">=</span> <span class="va">gender_age</span>,</span>
<span>      values_from <span class="op">=</span> <span class="va">DT</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      index <span class="op">=</span> <span class="op">(</span><span class="va">`F_20~24세`</span> <span class="op">+</span> <span class="va">`F_25~29세`</span> <span class="op">+</span> <span class="va">`F_30~34세`</span> <span class="op">+</span> <span class="va">`F_35~39세`</span><span class="op">)</span> <span class="op">/</span> <span class="va">`T_65세이상`</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>      <span class="va">C1</span>, <span class="va">C1_NM</span>, <span class="va">index</span>, <span class="va">PRD_DE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Visualization</span></span>
<span>  <span class="va">region</span> <span class="op">&lt;-</span> <span class="va">aoi</span><span class="op">$</span><span class="va">C1_NM</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># For Auto-Plot Title</span></span>
<span>  <span class="va">vis</span> <span class="op">&lt;-</span> <span class="va">aoi</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PRD_DE</span>, y<span class="op">=</span><span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">region</span>, <span class="st">" 인구소멸위험지수 추이"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"연도"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"인구소멸위험지수"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, hjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vis</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 함수 실행: 학생 작성 부분</span></span>
<span><span class="fu">exInd</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./lab_06.html" class="pagination-link  aria-label=" lab06:="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Lab06: 데이터 탐색하기</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Sang-Il Lee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://sangillee.snu.ac.kr/">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:si_lee@snu.ac.kr">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sangillee66">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>